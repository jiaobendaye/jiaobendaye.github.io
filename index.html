<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="我的博客">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="我的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="jiaobendaye">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>我的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">我的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/05/%E5%9F%BA%E4%BA%8EFlask%EF%BC%8CKeras%E9%83%A8%E7%BD%B2%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB%E6%9C%8D%E5%8A%A1API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiaobendaye">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/05/%E5%9F%BA%E4%BA%8EFlask%EF%BC%8CKeras%E9%83%A8%E7%BD%B2%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB%E6%9C%8D%E5%8A%A1API/" class="post-title-link" itemprop="url">基于Flask，Keras部署人脸识别服务API</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-05 09:59:05 / 修改时间：16:12:41" itemprop="dateCreated datePublished" datetime="2020-09-05T09:59:05+08:00">2020-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>之前做了一个人脸识别的项目，需要实现一个api，供其他终端设备(如树莓派，手机）访问。当终端设备把带有人脸的图片，通过api传给服务端后，返回人脸识别的结果。好了，下面开始介绍。</p>
<h1 id="一，背景知识"><a href="#一，背景知识" class="headerlink" title="一，背景知识"></a>一，背景知识</h1><p>本文主要参考的文章，<a target="_blank" rel="noopener" href="http://fancyerii.github.io/books/face-recognition/">人脸识别简介-李理</a>和<a target="_blank" rel="noopener" href="https://www.cnblogs.com/zyly/p/9703614.html">人脸检测MTCNN和人脸识别FaceNet</a>，大家可以点进去好好阅读。我再简要地说下人脸识别的算法原理。</p>
<p>利用深度学习来人脸识别，是目前的主流。以Google的FaceNet为例，其大致原理是，把检测（detected)到并对齐（aligned)后的人脸输入到神经网络，然后得到128维的嵌入向量（Embedding Vector），代表这一张人脸图片。通过比较两个向量之间的距离，来判断两张人脸是同一个人的可能性。距离越小，则越可能是同一个人。</p>
<p>由于本文主要讲怎么通过Flask部署api，所以具体的模型训练，请参考上面给的链接，以及FaceNet的论文。</p>
<h1 id="二，代码解释"><a href="#二，代码解释" class="headerlink" title="二，代码解释"></a>二，代码解释</h1><blockquote>
<p>完整代码<a target="_blank" rel="noopener" href="https://github.com/jiaobendaye/flask_face_recognition">链接</a>，下面我挑一些代码简单讲一下。</p>
</blockquote>
<h4 id="1）-主要的逻辑代码"><a href="#1）-主要的逻辑代码" class="headerlink" title="1） 主要的逻辑代码"></a>1） 主要的逻辑代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&#x27;/recognition&#x27;, methods=[&#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recognition</span>():</span></span><br><span class="line">    response = &#123;<span class="string">&#x27;success&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;prediction&#x27;</span>: <span class="string">&#x27;unk&#x27;</span>, <span class="string">&#x27;debug&#x27;</span>: <span class="string">&#x27;error&#x27;</span>&#125;</span><br><span class="line">    </span><br><span class="line">    received_image = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> request.files.get(<span class="string">&#x27;image&#x27;</span>): <span class="comment">#图像文件</span></span><br><span class="line">            image = request.files[<span class="string">&#x27;image&#x27;</span>].read()</span><br><span class="line">            received_image = <span class="literal">True</span></span><br><span class="line">            response[<span class="string">&#x27;debug&#x27;</span>] = <span class="string">&#x27;get image&#x27;</span></span><br><span class="line">            print(<span class="string">&#x27;receive file&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> request.get_json(): <span class="comment">#base64 编码的图像文件</span></span><br><span class="line">            encoded_image = request.get_json()[<span class="string">&#x27;image&#x27;</span>]</span><br><span class="line"></span><br><span class="line">            image = base64.b64decode(encoded_image)</span><br><span class="line">            received_image = <span class="literal">True</span></span><br><span class="line">            response[<span class="string">&#x27;debug&#x27;</span>] = <span class="string">&#x27;get json&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> received_image:</span><br><span class="line">            image = np.array(Image.open(BytesIO(image)))</span><br><span class="line">            result =  _recognition(image)</span><br><span class="line">            <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="string">&#x27;unk&#x27;</span>:</span><br><span class="line">                response[<span class="string">&#x27;prediction&#x27;</span>] = result</span><br><span class="line">            response[<span class="string">&#x27;success&#x27;</span>] = <span class="literal">True</span></span><br><span class="line">            response[<span class="string">&#x27;debug&#x27;</span>] = <span class="string">&#x27;predicted&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        response[<span class="string">&#x27;debug&#x27;</span>] = <span class="string">&#x27;No Post&#x27;</span></span><br><span class="line">    <span class="comment">#print(response)</span></span><br><span class="line">    <span class="keyword">return</span> jsonify(response)</span><br></pre></td></tr></table></figure>

<p>上面就是注册的路由，思路就是，通过POST接收到图像后，调用<code>_recogntion</code>，查看是否是数据库中的某个人。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_recognition</span>(<span class="params">img</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    return: result person name or unk</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment">#preprocess</span></span><br><span class="line">    img = align_image(img)</span><br><span class="line">    <span class="keyword">if</span> img <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># 数据规范化</span></span><br><span class="line">        img = (img / <span class="number">255.</span>).astype(np.float32)</span><br><span class="line">    <span class="keyword">else</span>: <span class="keyword">return</span> <span class="string">&#x27;unk&#x27;</span></span><br><span class="line">    <span class="comment"># embedding</span></span><br><span class="line">    <span class="keyword">global</span> session</span><br><span class="line">    <span class="keyword">global</span> graph</span><br><span class="line">    <span class="keyword">with</span> graph.as_default():</span><br><span class="line">        set_session(session)</span><br><span class="line">        embedding = nn4_small2.predict(np.expand_dims(img, axis=<span class="number">0</span>))</span><br><span class="line">    all_distance = [distance(embedding, emb) <span class="keyword">for</span> emb <span class="keyword">in</span> embedded]</span><br><span class="line">    min_dis =min(all_distance)</span><br><span class="line">    print(min_dis)</span><br><span class="line">    <span class="keyword">if</span> min_dis &gt; THRESHOLD:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;unk&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        min_index = np.argmin(all_distance)</span><br><span class="line">        <span class="keyword">return</span> targets[min_index]</span><br></pre></td></tr></table></figure>

<p><code>_recognition</code>的逻辑是:</p>
<ol>
<li><p>先预处理图片（检测人脸和对齐），如果未检测到人脸，直接返回<code>unk</code>。对齐后的人脸图片大小为96 * 96  * 3</p>
</li>
<li><p>然后通过<code>nn4_small2.predict()</code>将对齐后的人脸转为128维的嵌入向量。</p>
</li>
<li><p>分类。这里只是简单地计算该向量与数据库中所有向量的距离，然后找到距离最小的那个，根据最小距离与阈值的大小来决定，是否是同一个人。这种方法只适合数据库很小（人很少）的情况，当人数特别多时，不可能让你每次都计算所有的距离。这时就需要用<code>svm</code>来分类，具体怎么解决，我们下一节再讲。</p>
</li>
</ol>
<h4 id="2）阈值"><a href="#2）阈值" class="headerlink" title="2）阈值"></a>2）阈值</h4><p>前面提到，当最小距离大于阈值时，我们可以说不认识这个人。那么阈值是多少合理呢？这跟你的数据库中人脸数据的具体分布有关系。</p>
<p>我这里在网上找了一些明星图片作为示例数据，放在了<code>./images/</code>下。通过运行<code>threshold.py</code>会打印出不同阈值的f1值和准确率，如下图所示。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">╰─$ tree  ./images                                 </span><br><span class="line">./images</span><br><span class="line">├── fanBingBing</span><br><span class="line">│   ├── fanbingbing001.jpeg</span><br><span class="line">│   ├── fanbingbing002.jpeg</span><br><span class="line">│   └── fanbingbing003.jpeg</span><br><span class="line">├── huangXiaoMing</span><br><span class="line">│   ├── huangxiaoming001.jpeg</span><br><span class="line">...</span><br><span class="line">├── wangLiHong</span><br><span class="line">│   ├── wanglihong001.jpeg</span><br><span class="line">│   ├── wanglihong002.jpeg</span><br><span class="line">│   └── wanglihong003.jpeg</span><br><span class="line">└── xuWei</span><br><span class="line">    ├── xuwei001.jpeg</span><br><span class="line">    ├── xuwei002.jpeg</span><br><span class="line">    └── xuwei003.jpeg</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/14955960-9f6e5a59af2fd3e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="threshold.png"><br>可以看到，当阈值为0.3时，能达到94%的准确率。如何能使速度更快，预测更准呢？这是下面要讲的。</p>
<h1 id="三，扩展"><a href="#三，扩展" class="headerlink" title="三，扩展"></a>三，扩展</h1><h4 id="1-速度更快，svm"><a href="#1-速度更快，svm" class="headerlink" title="1)  速度更快，svm"></a>1)  速度更快，svm</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> LinearSVC</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line"></span><br><span class="line">encoder = LabelEncoder()</span><br><span class="line">encoder.fit(targets)</span><br><span class="line">y = encoder.transform(targets)</span><br><span class="line"></span><br><span class="line">svc = LinearSVC()</span><br><span class="line">svc.fit(embedded, y)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_recognition_svm</span>(<span class="params">img</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    return: result person name or unk</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment">#preprocess</span></span><br><span class="line">    img = align_image(img)</span><br><span class="line">    <span class="keyword">if</span> img <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="comment"># 数据规范化</span></span><br><span class="line">        img = (img / <span class="number">255.</span>).astype(np.float32)</span><br><span class="line">    <span class="keyword">else</span>: <span class="keyword">return</span> <span class="string">&#x27;unk&#x27;</span></span><br><span class="line">    <span class="comment"># embedding</span></span><br><span class="line">    <span class="keyword">global</span> session</span><br><span class="line">    <span class="keyword">global</span> graph</span><br><span class="line">    <span class="keyword">with</span> graph.as_default():</span><br><span class="line">        set_session(session)</span><br><span class="line">        embedding = nn4_small2.predict(np.expand_dims(img, axis=<span class="number">0</span>))</span><br><span class="line">    prediction = svc.predict(embedding)</span><br><span class="line">    identity = encoder.inverse_transform(prediction)[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># enbedded_identity ,is the embeddings in the dataset which name is identity</span></span><br><span class="line">    embedded_identity = embedded[np.where(targets == identity)[<span class="number">0</span>]]</span><br><span class="line">    all_distance = [distance(embedding, emb) <span class="keyword">for</span> emb <span class="keyword">in</span> embedded_identity]</span><br><span class="line">    min_dis = min(all_distance)</span><br><span class="line">    <span class="comment"># print(min_dis)</span></span><br><span class="line">    <span class="keyword">if</span> min_dis &gt; THRESHOLD:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;unk&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> identity</span><br></pre></td></tr></table></figure>
<p>与不带<code>svm</code>的分类器相比，使用<code>svm</code>来分类的速度只和<code>svm</code>模型自己的大小相关。然而<code>svm</code>只会预测出<code>fit()</code>过的类，这导致两个问题需要解决：</p>
<ol>
<li><p>就算你随机输入一个128维的向量，分类器也会给出一个数据库中存在的<code>label</code>。所以在<code>svm</code>分类器预测之后，我们需要额外地计算目标嵌入向量与分类器所给的类别中的向量之间的距离。但是相比于计算整个数据库中的向量，已经是很快了。</p>
</li>
<li><p>当有新的人(<code>label</code>)加入，我们需要重新<code>fit</code>分类器<code>svm</code>。</p>
</li>
</ol>
<h4 id="2-预测更准-微调-fine-tune"><a href="#2-预测更准-微调-fine-tune" class="headerlink" title="2) 预测更准,微调(fine-tune)"></a>2) 预测更准,微调(fine-tune)</h4><p>由于神经网络模型的权重是由<code>LFW</code>数据集训练的，对亚洲人的区分，没有对西方人的那么好。如果对预测效果有更好的要求，可以在其基础上进行微调。</p>
<p>网上也有人分享自己训练过的FaceNet的权重，大家自己去搜，我就不放出来了，因为我也没用过。</p>
<h1 id="四，一些坑"><a href="#四，一些坑" class="headerlink" title="四，一些坑"></a>四，一些坑</h1><ul>
<li>flask多线程<br>在实现过程中，有一个问题一直困扰我，后来终于google到了<a target="_blank" rel="noopener" href="https://github.com/tensorflow/tensorflow/issues/28287">issue</a>。原来是因为<code>Flask</code>对<code>requests</code>进行回应时，会使用多线程的代码，然而，对于<code>Tensorflow（1.13）</code>，这样是不允许的。<br>所以，在<code>load_model()</code>和<code>model.predict()</code>之前都加了一些设置<code>graph</code>,<code>session</code>的代码。可以直接在代码里看到，这里不贴图了。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/05/Anaconda-%E5%AE%89%E8%A3%85R%E5%B9%B6%E9%85%8D%E7%BD%AEBioconductor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiaobendaye">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/05/Anaconda-%E5%AE%89%E8%A3%85R%E5%B9%B6%E9%85%8D%E7%BD%AEBioconductor/" class="post-title-link" itemprop="url">Anaconda 安装R并配置Bioconductor</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-05 09:57:57 / 修改时间：16:12:41" itemprop="dateCreated datePublished" datetime="2020-09-05T09:57:57+08:00">2020-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="写在前面-R的安装的几种方式"><a href="#写在前面-R的安装的几种方式" class="headerlink" title="写在前面 R的安装的几种方式"></a>写在前面 R的安装的几种方式</h3><p>1, 通过apt-get ，yum安装，</p>
<ul>
<li>对于linux系统，通过系统的包管理安装时很方便，但是在用起来就很苦恼了。</li>
<li>首先,版本老旧，我在ubuntu上通过系统官方源安装的是<code>3.4</code>版本，几乎不能用了。只有添加R的最新的源才行。</li>
<li>其次，R对于root和非root用户的反应是不一样的，主要体现在，当安装或更新包时，对某些路径权限不足</li>
</ul>
<p>2, 源码安装</p>
<ul>
<li>我没试过，姿势要求太高，不建议小白尝试。</li>
</ul>
<p>3, Anaconda</p>
<ul>
<li>通过Anaconda安装R如丝般润滑，不需要你去关心权限问题，所有的包都在conda的虚拟环境下。</li>
<li>当你通过conda安装BiocManager之后，简直一路开挂，几乎扫清了你使用前两种方式的所有障碍</li>
</ul>
<p>4,通过docker安装</p>
<ul>
<li>前提是你要会docker的基本命令，学好docker还是蛮重要的</li>
</ul>
<hr>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><blockquote>
<p>Configuration failed because libcurl was not found.</p>
</blockquote>
<h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法:"></a>解决办法:</h4><ol>
<li>将<code>/usr/local/lib/pkgconfig</code>添加到PATH<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#.basrc或.zshrc里加入</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;local&#x2F;lib&#x2F;pkgconfig</span><br></pre></td></tr></table></figure></li>
<li>安装<code>/usr/local/lib/pkgconfig/libcurl.pc</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;curl&#x2F;curl&#x2F;releases&#x2F;download&#x2F;curl-7_55_0&#x2F;curl-7.55.0.tar.gz</span><br><span class="line">tar -zxvf curl-7.55.0.tar.gz</span><br><span class="line">cd curl-7.55.0&#x2F;</span><br><span class="line">.&#x2F;configure</span><br><span class="line">make </span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="一，-创建R虚拟环境，并安装BiocManager"><a href="#一，-创建R虚拟环境，并安装BiocManager" class="headerlink" title="一， 创建R虚拟环境，并安装BiocManager"></a>一， 创建R虚拟环境，并安装BiocManager</h3><ul>
<li>这一部分是在OS shell下面的conda操作:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#创建</span><br><span class="line">conda create -n Renv r-essentials r-base </span><br><span class="line">#激活</span><br><span class="line">conda activate Renv</span><br><span class="line">#使用conda 安装BiocManager</span><br><span class="line">conda install r-biocmanager</span><br></pre></td></tr></table></figure>

</li>
</ul>
<hr>
<h3 id="二，-配置清华源"><a href="#二，-配置清华源" class="headerlink" title="二， 配置清华源"></a>二， 配置清华源</h3><ul>
<li>后面的部分都是在R shell里执行的R命令</li>
</ul>
<p>因为基础的R包和Bioconductor包都是在国外，所以如果你的终端无法访问外网的话，必须设置R的国内镜像源.<br>如果你的<code>~/.condarc</code>里面配置了 <code>bioconda:https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</code>，则只需要再配置基础R包的国内镜像就可以了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#Bioconductor的国内源</span><br><span class="line">&gt;options(BioC_mirror&#x3D;&quot;https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;bioconductor&quot;)</span><br><span class="line">#基础R包的国内源</span><br><span class="line">&gt;options(&quot;repos&quot; &#x3D; c(CRAN&#x3D;&quot;https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;CRAN&#x2F;&quot;))</span><br><span class="line">#可以把上面两句加入到~&#x2F;.Rprofile，这样R会在启动时自动配置</span><br><span class="line">#载入BiocManager</span><br><span class="line">&gt;library(&#39;BiocManager&#39;)</span><br><span class="line">#通过BiocManager的repositories()查看镜像是否配置成功</span><br><span class="line">&gt;repositories()</span><br></pre></td></tr></table></figure>
<p>如果repsitories()显示的结果如下所示，则证明配置成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; repositories()</span><br><span class="line">                                                                         BioCsoft </span><br><span class="line">           &quot;https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;bioconductor&#x2F;packages&#x2F;3.10&#x2F;bioc&quot; </span><br><span class="line">                                                                          BioCann </span><br><span class="line">&quot;https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;bioconductor&#x2F;packages&#x2F;3.10&#x2F;data&#x2F;annotation&quot; </span><br><span class="line">                                                                          BioCexp </span><br><span class="line">&quot;https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;bioconductor&#x2F;packages&#x2F;3.10&#x2F;data&#x2F;experiment&quot; </span><br><span class="line">                                                                    BioCworkflows </span><br><span class="line">      &quot;https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;bioconductor&#x2F;packages&#x2F;3.10&#x2F;workflows&quot; </span><br><span class="line">                                                                             CRAN </span><br><span class="line">                                     &quot;https:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;CRAN&#x2F;&quot; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="三，-更新R包"><a href="#三，-更新R包" class="headerlink" title="三， 更新R包"></a>三， 更新R包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;BiocManager::valid()</span><br><span class="line">&gt;update.packages(checkBuilt&#x3D;TRUE, ask&#x3D;FALSE)  </span><br></pre></td></tr></table></figure>
<hr>
<h3 id="四，-安装GOstats"><a href="#四，-安装GOstats" class="headerlink" title="四， 安装GOstats"></a>四， 安装GOstats</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;BiocManager::install(&#39;GOstats&#39;)</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="写在后面，关于R的包发布"><a href="#写在后面，关于R的包发布" class="headerlink" title="写在后面，关于R的包发布"></a>写在后面，关于R的包发布</h3><p>任何一门语言都有管理包的需求，这样才能避免重复的造轮子，像<code>python</code>的<code>pip</code>，<code>go</code>的<code>go get</code>．这都是很好的包管理工具</p>
<p>对于R来说，<code>CRAN</code>跟<code>Bioconductor</code>是其主要的包发布平台，意思是，当你想要分享你的代码时，你可以把其规范化后发布到任意一个平台上．安装<code>CRAN</code>的包需要执行<code>install.packages()</code>,而安装<code>Bioconductor</code>的包需要<code>BiocManager::install()</code>．</p>
<p>基本上，基础的<code>CRAN</code>包在两个平台上都能找到，而因为<code>Bioconductor</code>的管理更加规范，审核也更加严格，建议能使用后者就使用后者．</p>
<p><code>BiocInstaller</code>已经是被淘汰的<code>Bioconductor</code>包管理工具，不建议使用．</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/05/flask%E5%AE%9E%E8%B7%B5-gunicorn%E4%B8%8E-env/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiaobendaye">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/05/flask%E5%AE%9E%E8%B7%B5-gunicorn%E4%B8%8E-env/" class="post-title-link" itemprop="url">flask实践   gunicorn与.env</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-05 09:57:17 / 修改时间：16:12:41" itemprop="dateCreated datePublished" datetime="2020-09-05T09:57:17+08:00">2020-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="env"><a href="#env" class="headerlink" title=".env"></a>.env</h2><p>生产环境下，<code>.env</code>通常用来保存私密的信息（如密钥等），<br>在<code>.gitignore</code>中添加<code>.env</code>，使得其不会上传到公共仓库中，以保护私密信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># filename: .env</span><br><span class="line">TEST_AK &#x3D; blabla</span><br><span class="line">TEST_SK &#x3D; blabla</span><br></pre></td></tr></table></figure>

<p>flask 默认会通过<code>.env</code>，（前提是需要安装<code>python-dotenv</code>）并将其加载到环境变量中，在程序中通过<code>os.getenv(&#39;TEST_AK&#39;)</code>获取环境变量，达到读取私密信息的目的。</p>
<h2 id="gunicorn"><a href="#gunicorn" class="headerlink" title="gunicorn"></a>gunicorn</h2><p>由于flask默认的wsgi处理高并发还是鲁棒性都有所欠缺，我们通常会使用gunicorn，uWSGI等WSGI容器 来部署flask项目</p>
<p>我们可以通过<code>gunicorn -c path_to_gunicorn_conf path_to_app:app</code>来使得gunicorn代替flask默认的wsgi。</p>
<p>但这时，flask就不会自动导入<code>.env</code>到环境变量了，需要手动的去导入。<br>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#filename: app.py</span><br><span class="line">from dotenv import load_dotenv</span><br><span class="line">#.env 与app.py 在同一路径下</span><br><span class="line">load_dotenv(&#39;.env&#39;)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/05/ubuntu-%E8%B0%83%E6%95%99%E8%A7%A6%E6%91%B8%E6%9D%BF%E6%88%90Mac%E9%A3%8E%E6%A0%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiaobendaye">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/05/ubuntu-%E8%B0%83%E6%95%99%E8%A7%A6%E6%91%B8%E6%9D%BF%E6%88%90Mac%E9%A3%8E%E6%A0%BC/" class="post-title-link" itemprop="url">ubuntu 调教触摸板成Mac风格</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-05 09:56:14 / 修改时间：16:12:41" itemprop="dateCreated datePublished" datetime="2020-09-05T09:56:14+08:00">2020-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>之前在公司用的Mac，触摸板的多指操作给我留下了很深的印象．<br>但是自己主要开发还是在Linux下，所以折腾了一下，使得自己的笔记本的触摸板更加人性化（也就是仿Mac）</p>
<blockquote>
<p>教程目标：通过触摸板实现显示当前工作区(<code>workspace</code>)窗口以及切换工作区操作</p>
</blockquote>
<h3 id="1-检查触摸板"><a href="#1-检查触摸板" class="headerlink" title="1. 检查触摸板"></a>1. 检查触摸板</h3><p>首先你的触摸板需要支持多指操作，大部分都是支持的，可以通过如下方式测试:<br>ubuntu默认的三指点击，模拟的鼠标滚轮的点击(<code>middle-click</code>)，会触发粘贴操作(<code>ctrl+v</code>)，感觉很鸡肋有么有．<br>你可以先复制一段文字，然后打开文本或输入框，三个手指头同时点击触摸板，如何能够粘贴，则是支持的．</p>
<h3 id="2-安装软件，并配置"><a href="#2-安装软件，并配置" class="headerlink" title="2. 安装软件，并配置"></a>2. 安装软件，并配置</h3><p>需要的软件为<code>fusuma</code>，主要参考的文章为<a target="_blank" rel="noopener" href="https://blog.csdn.net/NiYintang/article/details/86653726">Ubuntu16.04自定义触控板实现多指手势控制</a>，跟github介绍的步骤一致，按着顺序敲就行了，这里就不再赘述．<br>最主要的是个性化的配置<code>~/.config/fusuma/config.yml</code>，为了实现类似Mac的风格，主要就是对三指的轻扫操作(<code>swipe</code>)进行配置．</p>
<p>配置文件的具体内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">swipe:</span><br><span class="line">  3: </span><br><span class="line">    left: </span><br><span class="line">      command: &#39;xdotool key alt+ctrl+Down&#39;</span><br><span class="line">    right: </span><br><span class="line">      command: &#39;xdotool key alt+ctrl+Up&#39;</span><br><span class="line">    up:</span><br><span class="line">      command: &#39;xdotool key super&#39;</span><br><span class="line">    down:</span><br><span class="line">      command: &#39;xdotool key super+d&#39;</span><br><span class="line">threshold:</span><br><span class="line">  swipe: 0.5</span><br><span class="line">  pinch: 0.5</span><br><span class="line"> </span><br><span class="line">interval:</span><br><span class="line">  swipe: 0.5</span><br><span class="line">  pinch: 0.5</span><br></pre></td></tr></table></figure>
<p><code>super</code>就是<code>alt</code>左边的那个跟微软的图标一样的功能键．不懂的同学可以先测试一下<code>spuer</code>以及<code>alt+ctrl+Up</code>，<code>Up</code>就是上箭头，体验一下工作区的概念．当你打开了许多窗口，这个功能还是很重要的．</p>
<h3 id="3-禁止三指点击模拟middle-click"><a href="#3-禁止三指点击模拟middle-click" class="headerlink" title="3. 禁止三指点击模拟middle-click"></a>3. 禁止三指点击模拟middle-click</h3><p>上面已经提到，ubuntu默认会把三指点击对应成<code>middle-click</code>，并进行粘贴操作．当你在浏览文本时，想要通过三指切换工作区，系统很有可能会先执行一遍粘贴操作，把粘贴板的内容粘贴进去，(简直太坑爹了)．下面来介绍如何禁止这一操作．</p>
<p>参考文章<a target="_blank" rel="noopener" href="https://ubuntuqa.com/article/687.html">如何禁用鼠标中键点击粘贴？</a></p>
<p>我尝试了<code>tweak</code>，<code>easystroke</code>均未成功，或效果不好，最后还是通过<code>~/.Xmodmap</code>文件解决了这个问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;pointer &#x3D; 1 25 3 4 5 6 7 8 9&quot;  &gt;  ~&#x2F;.Xmodmap</span><br></pre></td></tr></table></figure>
<p>重启之后，三指点击应该就不会触发粘贴操作了，可以舒舒服服地体验三指切换工作区的快感了．</p>
<h3 id="4-一些BUG"><a href="#4-一些BUG" class="headerlink" title="4.一些BUG"></a>4.一些BUG</h3><p>使用过程中，有时候会遇到<code>fusuma</code>停止工作的现象，在看了github的issue后发现，是<code>fusuma</code>无法正确识别出三指和二指的问题．<br>可以用四根手指轻扫触摸板，多扫几次，<code>fusuma</code>就能正常识别三指了，这是个人的使用经验，不一定对所有人适用．</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/05/R%E8%AF%AD%E8%A8%80GO%E5%AF%8C%E9%9B%86%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiaobendaye">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/05/R%E8%AF%AD%E8%A8%80GO%E5%AF%8C%E9%9B%86%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">R语言GO富集分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-05 09:54:33 / 修改时间：16:12:41" itemprop="dateCreated datePublished" datetime="2020-09-05T09:54:33+08:00">2020-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在生物信息学领域中，对基因集合的富集分析是对基因信息进行挖掘的必要手段．python有<a target="_blank" rel="noopener" href="https://github.com/guma44/GEOparse"><code>GEOParse</code></a>，<a target="_blank" rel="noopener" href="https://github.com/tanghaibao/goatools"><code>GOATOOLS</code></a>等工具，matlab中有<code>geosoftread</code>，<code>getgeodata</code>和<a target="_blank" rel="noopener" href="https://ww2.mathworks.cn/help/bioinfo/ref/goannotread.html"><code>goannotread</code></a>．但是，这一领域的霸主还是R语言</p>
<p>R语言下有<code>GOStats</code>，以及<code>clusterProfiler</code>包可以用来做GO富集分析，后者是在前者上的更高级的封装，并且由华人开发．</p>
<p>但python的语法和<code>api</code>更加通俗易懂，所以我一般用python 预处理（Preprocess）和后处理（Postprocess）数据，中间只有富集分析时才会用到R语言，通过csv文件来打通语言之间的隔阂．</p>
<h3 id="一，什么是GO富集"><a href="#一，什么是GO富集" class="headerlink" title="一，什么是GO富集"></a>一，什么是GO富集</h3><p>我们知道，某些疾病是跟某些基因有关的，然而＂有关＂只是一个很模糊的概念，需要更专业的术语来描述．GO(Gene Ontology)就是精确表述基因与生物过程关系的数据库．在生物过程中，基因（DNA）通过mRNA来合成蛋白质，从而参与到分子组成，生物功能中去．</p>
<p>GO 数据库的出发点就是统一表示所有物种的基因及其功能,并将基因的功能分为三大类:分子功能(Molecular Function, MF)、细胞组成(Cell　Components, CC)和生物过程(Biological Process, BP)。每一个功能都对应了一个<code>GO Term</code> ，有一个唯一的ID对应．</p>
<p>富集（<code>enrich</code>）是一个统计学的概念，与之相关是<code>P-Value</code>．我们通过一个例子来说明．</p>
<table>
<thead>
<tr>
<th></th>
<th>基因子集</th>
<th>总的基因</th>
</tr>
</thead>
<tbody><tr>
<td>基因个数</td>
<td>2500</td>
<td>20000</td>
</tr>
<tr>
<td>Term相关基因个数</td>
<td>200</td>
<td>400</td>
</tr>
</tbody></table>
<p>假设人总共的基因个数是20000个，其中有400个与某个<code>GO Term</code>相关．当我们找到了一个包含2500个基因的子集合，其中有200个与该<code>GO Term</code>相关．按照统计的观点，如果你的子集合是随机生成的话，分布是不会改变的，那么与该<code>Term</code>相关的基因个数应该在40左右，但事实是远高于这个<code>baseline</code>．用更专业的说法就是该子集合在该<code>Term</code>出现了富集，或富集在了该<code>Term</code>．并用<code>P-value</code>来衡量富集的程度，其越小则程度越深</p>
<h3 id="二，-获取基因子集"><a href="#二，-获取基因子集" class="headerlink" title="二， 获取基因子集"></a>二， 获取基因子集</h3><h4 id="1-基因表达数据"><a href="#1-基因表达数据" class="headerlink" title="1. 基因表达数据"></a>1. 基因表达数据</h4><p>基因表达数据，是在不同样本或条件下测量mRNA浓度得到的，其用来表示基因的表达水平．一般人是没有条件通过实验获得该数据的，但是可以在网上下载，如GEO数据库．</p>
<p>GEO数据库上面有大量的资源，并且很多都是权威的，被很多论文用来做实验的．它定义了一些协议用来记录基因表达数据，如<code>GSE</code>，<code>GPL</code>等，需要先了解之够才能正确使用．建议用R或者python的<code>GEOParse</code>来获取和处理这些数据．</p>
<h4 id="2-进行挖掘"><a href="#2-进行挖掘" class="headerlink" title="2. 进行挖掘"></a>2. 进行挖掘</h4><p>从GEO获得数据是原始数据，还需进行挖掘得到我们所要的子基因集合，通常的做法是聚类，更具体一点是双聚类，这可以单独开一章节去讲了，就不班门弄斧了．双聚类之后就可以得到感兴趣的子集合了．另外提一句，很多算法是用matlab实现的．</p>
<h3 id="三，-分析并做图"><a href="#三，-分析并做图" class="headerlink" title="三， 分析并做图"></a>三， 分析并做图</h3><p>这里通过<code>clustrtProfiler</code>来进行富集分析，更多的用法参考其文档．</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(<span class="string">&#x27;clusterProfiler&#x27;</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">&#x27;topGO&#x27;</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">&#x27;Rgraphviz&#x27;</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">&#x27;pathview&#x27;</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">&#x27;org.Hs.eg.db&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#pick out gene symbol</span></span><br><span class="line">DEGs &lt;- c(<span class="string">&quot;AHNAK2&quot;</span>, <span class="string">&quot;AQP7&quot;</span>, <span class="string">&quot;DNAH11&quot;</span> , <span class="string">&quot;FLG&quot;</span>, <span class="string">&quot;HNRNPCL2&quot;</span>, <span class="string">&quot;HRNR&quot;</span> , <span class="string">&quot;KMT2C&quot;</span>,    </span><br><span class="line">             <span class="string">&quot;KMT2D&quot;</span>, <span class="string">&quot;MST1L&quot;</span>, <span class="string">&quot;MUC12&quot;</span>, <span class="string">&quot;MUC16&quot;</span>, <span class="string">&quot;MUC17&quot;</span>, <span class="string">&quot;MUC19&quot;</span>, <span class="string">&quot;MUC3A&quot;</span>,     </span><br><span class="line">              <span class="string">&quot;MUC4&quot;</span>, <span class="string">&quot;MUC5B&quot;</span>, <span class="string">&quot;MUC6&quot;</span>, <span class="string">&quot;PABPC3&quot;</span>, <span class="string">&quot;PDE4DIP&quot;</span>, <span class="string">&quot;PLEC&quot;</span> , <span class="string">&quot;TTN&quot;</span>,    </span><br><span class="line">              <span class="string">&quot;ANKRD36&quot;</span>, <span class="string">&quot;FCGBP&quot;</span>, <span class="string">&quot;HERC2&quot;</span>, <span class="string">&quot;IGFN1&quot;</span>, <span class="string">&quot;KRT18&quot;</span>, <span class="string">&quot;SLC25A5&quot;</span>, <span class="string">&quot;SYNE2&quot;</span>,    </span><br><span class="line">             <span class="string">&quot;RYR1&quot;</span>, <span class="string">&quot;TNS1&quot;</span>, <span class="string">&quot;DST&quot;</span>, <span class="string">&quot;SYNE1&quot;</span>, <span class="string">&quot;TSNARE1&quot;</span>, <span class="string">&quot;NBPF19&quot;</span>, <span class="string">&quot;NBPF26&quot;</span>,    </span><br><span class="line">              <span class="string">&quot;PRKCB&quot;</span>, <span class="string">&quot;ADGRG1&quot;</span>, <span class="string">&quot;OPCML&quot;</span>)   </span><br><span class="line"></span><br><span class="line">DEGs_entrez_id&lt;-mapIds(x=org.Hs.eg.db,column = <span class="string">&#x27;ENTREZID&#x27;</span>,</span><br><span class="line">                       keys = as.character(DEGs),keytype = <span class="string">&#x27;SYMBOL&#x27;</span>)</span><br><span class="line"></span><br><span class="line">enrich_go_BP&lt;-enrichGO(gene = DEGs_entrez_id,</span><br><span class="line">                       OrgDb = <span class="string">&#x27;org.Hs.eg.db&#x27;</span>,</span><br><span class="line">                       ont = <span class="string">&#x27;BP&#x27;</span>,pvalueCutoff = <span class="number">0.05</span>)</span><br><span class="line"></span><br><span class="line">enrich_go_MF&lt;-enrichGO(gene = DEGs_entrez_id,</span><br><span class="line">                       OrgDb = <span class="string">&#x27;org.Hs.eg.db&#x27;</span>,</span><br><span class="line">                       ont = <span class="string">&#x27;MF&#x27;</span>,pvalueCutoff = <span class="number">0.05</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enrich_go_CC&lt;-enrichGO(gene = DEGs_entrez_id,</span><br><span class="line">                       OrgDb = <span class="string">&#x27;org.Hs.eg.db&#x27;</span>,</span><br><span class="line">                       ont = <span class="string">&#x27;CC&#x27;</span>,pvalueCutoff = <span class="number">0.05</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enrich_go_KEGG&lt;-enrichKEGG(gene = DEGs_entrez_id,organism = <span class="string">&#x27;hsa&#x27;</span>,</span><br><span class="line">                           keyType = <span class="string">&#x27;kegg&#x27;</span>,pvalueCutoff = <span class="number">0.05</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">barplot(enrich_go_BP)</span><br><span class="line">barplot(enrich_go_CC)</span><br><span class="line">barplot(enrich_go_MF)</span><br><span class="line">barplot(enrich_go_KEGG)</span><br><span class="line"></span><br><span class="line">dotplot(enrich_go_BP,title=<span class="string">&#x27;Biological Process of DEGs&#x27;</span>)</span><br><span class="line">dotplot(enrich_go_MF,title=<span class="string">&#x27;Molecular function of DEGs&#x27;</span>)</span><br><span class="line">dotplot(enrich_go_KEGG,title=<span class="string">&#x27;KEGG pathway of DEGs&#x27;</span>)</span><br><span class="line">dotplot(enrich_go_CC,title=<span class="string">&#x27;Cell Component of DEGs&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/05/%E5%88%86%E4%BA%AB%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E5%A5%BD%E7%94%A8%E7%9A%84makefile/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiaobendaye">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/05/%E5%88%86%E4%BA%AB%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E5%A5%BD%E7%94%A8%E7%9A%84makefile/" class="post-title-link" itemprop="url">分享一个简单好用的makefile</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-05 09:53:29 / 修改时间：16:12:41" itemprop="dateCreated datePublished" datetime="2020-09-05T09:53:29+08:00">2020-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>makefile: 让一切make起来</p>
<h3 id="一，makefile文件内容"><a href="#一，makefile文件内容" class="headerlink" title="一，makefile文件内容"></a>一，makefile文件内容</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">CXX := -c++</span><br><span class="line">CXXFLAGS := -pedantic-errors -Wall -Wextra -Werror</span><br><span class="line">LDFLAGS := -L/usr/lib -lstdc++ -lm</span><br><span class="line">BUILD := ./build</span><br><span class="line">OBJ_DIR := <span class="variable">$(BUILD)</span>/objects</span><br><span class="line">APP_DIR := <span class="variable">$(BUILD)</span>/apps</span><br><span class="line">TARGET := myApp</span><br><span class="line">INCLUDE := -Iinclude/</span><br><span class="line">SRC  :=								\</span><br><span class="line">	<span class="variable">$(<span class="built_in">wildcard</span> src/module1/*.cpp)</span>	\</span><br><span class="line">	<span class="variable">$(<span class="built_in">wildcard</span> src/module2/*.cpp)</span>	\</span><br><span class="line">	<span class="variable">$(<span class="built_in">wildcard</span> src/module3/*.cpp)</span>	\</span><br><span class="line">	<span class="variable">$(<span class="built_in">wildcard</span> src/*.cpp)</span>	\</span><br><span class="line"></span><br><span class="line">OBJECTS := $(SRC:%.cpp=<span class="variable">$(OBJ_DIR)</span>/%.o)</span><br><span class="line"></span><br><span class="line"><span class="section">all: build <span class="variable">$(APP_DIR)</span>/<span class="variable">$(TARGET)</span></span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(OBJ_DIR)</span>/%.o: %.cpp</span><br><span class="line">	@mkdir -p $(@D)</span><br><span class="line">	<span class="variable">$(CXX)</span> <span class="variable">$(CXXFLAGS)</span> <span class="variable">$(INCLUDE)</span> -o <span class="variable">$@</span> -c <span class="variable">$&lt;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(APP_DIR)</span>/<span class="variable">$(TARGET)</span>: <span class="variable">$(OBJECTS)</span></span><br><span class="line">	@mkdir -p $(@D)</span><br><span class="line">	<span class="variable">$(CXX)</span> <span class="variable">$(CXXFLAGS)</span> <span class="variable">$(INCLUDE)</span> <span class="variable">$(LDFLAGS)</span> -o <span class="variable">$(APP_DIR)</span>/<span class="variable">$(TARGET)</span> <span class="variable">$(OBJECTS)</span> </span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>: all build clean debug release</span></span><br><span class="line">	</span><br><span class="line"><span class="section">build:</span></span><br><span class="line">	@mkdir -p <span class="variable">$(APP_DIR)</span></span><br><span class="line">	@mkdir -p <span class="variable">$(OBJ_DIR)</span></span><br><span class="line"></span><br><span class="line"><span class="section">debug: CXXFLAGS += -DEGUG -g</span></span><br><span class="line"><span class="section">debug: all</span></span><br><span class="line"></span><br><span class="line"><span class="section">release: CXXFLAGS += -02</span></span><br><span class="line"><span class="section">release: all</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	-@rm -rvf <span class="variable">$(OBJ_DIR)</span>/*</span><br><span class="line">	-@rm -rvf <span class="variable">$(APP_DIR)</span>/*</span><br></pre></td></tr></table></figure>
<p>由于直接粘贴复制可能会导致TAB变空格，所以这里给出下载链接<br><a target="_blank" rel="noopener" href="https://www.jianguoyun.com/p/DRBSggsQ7IDABxjA8-8C">下载链接</a></p>
<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── build</span><br><span class="line">│   ├── apps</span><br><span class="line">│   │   └── myApp</span><br><span class="line">│   └── objects</span><br><span class="line">│       └── src</span><br><span class="line">│           ├── my1st.o</span><br><span class="line">│           └── test.o</span><br><span class="line">├── include</span><br><span class="line">│   └── test.h</span><br><span class="line">├── makefile</span><br><span class="line">└── src</span><br><span class="line">    ├── my1st.cpp</span><br><span class="line">    └── test.cpp</span><br></pre></td></tr></table></figure>
<h3 id="三，使用说明"><a href="#三，使用说明" class="headerlink" title="三，使用说明"></a>三，使用说明</h3><ul>
<li>头文件放在<code>./include/</code></li>
<li>cpp文件放在<code>./src/</code>，然后直接<code>make</code></li>
<li><code>*.o</code>目标文件依赖<code>./src/</code>下的<code>*.cpp</code>源文件，源文件经过预编译，编译，汇编后生成目标文件，放在在<code>./build/objects/</code>下</li>
<li>可执行文件<code>$&#123;TARGET&#125;</code>依赖<code>*.o</code>目标文件，将<code>*.o</code>目标文件链接生成可执行文件，放在<code>./build/apps/</code>下</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/05/c-%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E8%B5%8B%E5%80%BC%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiaobendaye">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/05/c-%E7%B1%BB%E7%9A%84%E6%9E%84%E9%80%A0%E5%92%8C%E8%B5%8B%E5%80%BC%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">c++ 类的构造和赋值函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-05 09:52:13 / 修改时间：16:12:41" itemprop="dateCreated datePublished" datetime="2020-09-05T09:52:13+08:00">2020-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>以customize String类为例，介绍拷贝构造（<code>copy construction function</code>），拷贝赋值（<code>copy assignment function</code>）以及移动构造（<code>move construction function</code>）和移动赋值函数（<code>move assignment function</code>）</p>
<h3 id="一，类定义"><a href="#一，类定义" class="headerlink" title="一，类定义"></a>一，类定义</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">String</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:<span class="comment">//公有的声明</span></span><br><span class="line">	String(<span class="keyword">const</span> <span class="keyword">char</span>*); <span class="comment">//构造函数</span></span><br><span class="line">	String(<span class="keyword">int</span> n,<span class="keyword">char</span> c); <span class="comment">//传入大小的构造函数</span></span><br><span class="line">	~String(); <span class="comment">//析构函数</span></span><br><span class="line"></span><br><span class="line">	String(<span class="keyword">const</span> String &amp;str);  <span class="comment">//拷贝构造函数</span></span><br><span class="line">	String&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> String&amp; str);<span class="comment">//拷贝赋值函数，我们在不需要修改参数的值的地方都应该声明为const</span></span><br><span class="line"></span><br><span class="line">    String(String&amp;&amp; other);<span class="comment">//移动构造函数</span></span><br><span class="line">    String&amp; <span class="keyword">operator</span>=(String&amp;&amp; other);<span class="comment">//移动赋值函数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">char</span>* m_pchar;<span class="comment">//保存字符串的首地址</span></span><br><span class="line">	<span class="keyword">int</span> m_size;  <span class="comment">//字符串的字符大小</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="二，为什么要有这些函数"><a href="#二，为什么要有这些函数" class="headerlink" title="二，为什么要有这些函数"></a>二，为什么要有这些函数</h3><ul>
<li>动态内存</li>
<li>浅拷贝和深拷贝</li>
</ul>
<h2 id="三，参考写法"><a href="#三，参考写法" class="headerlink" title="三，参考写法"></a>三，参考写法</h2><p>###3.1 拷贝构造，copy constructor function</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String::String(<span class="keyword">const</span> String&amp;  other)&#123;</span><br><span class="line">    m_pchar = <span class="keyword">new</span> <span class="keyword">char</span>[other.size +<span class="number">1</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(m_pchar, other.m_pchar);</span><br><span class="line">    m_size = other.m_size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-拷贝赋值，copy-assignment-function"><a href="#3-2-拷贝赋值，copy-assignment-function" class="headerlink" title="3.2 拷贝赋值，copy assignment function"></a>3.2 拷贝赋值，copy assignment function</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> String&amp; String::oparator =(<span class="keyword">const</span> String&amp; other)&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;other) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">char</span> *p = <span class="keyword">new</span> <span class="keyword">char</span>[other.m_size+<span class="number">1</span>];</span><br><span class="line">    <span class="built_in">strcpy</span>(p, other.m_pchar);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(m_pchar) <span class="keyword">delete</span>[] m_pchar;</span><br><span class="line">    </span><br><span class="line">    m_pchar = p;</span><br><span class="line">    m_size = other.m_size;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-3-移动构造，move-constructor-function"><a href="#3-3-移动构造，move-constructor-function" class="headerlink" title="3.3 移动构造，move constructor function"></a>3.3 移动构造，move constructor function</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">String::String(String&amp;&amp;  other)</span><br><span class="line">    :m_pchar(other.m_pchar),</span><br><span class="line">    m_size(other.m_size)</span><br><span class="line">&#123;</span><br><span class="line">    other.m_pchar = <span class="literal">nullptr</span>;</span><br><span class="line">    other.m_size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-移动赋值，-move-assignment-function"><a href="#3-4-移动赋值，-move-assignment-function" class="headerlink" title="3.4 移动赋值， move assignment function"></a>3.4 移动赋值， move assignment function</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">String&amp; String::<span class="keyword">operator</span>=(String&amp;&amp; other)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>!=&amp;other)&#123;</span><br><span class="line">        <span class="keyword">if</span>(m_pchar) <span class="keyword">delete</span>[] m_pchar;</span><br><span class="line"></span><br><span class="line">        m_pchar = other.m_pchar;</span><br><span class="line">        m_size = other.m_size;</span><br><span class="line"></span><br><span class="line">        other.m_pchar = <span class="literal">nullptr</span>;</span><br><span class="line">        other.m_size=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><p>当创建对象且直接初始化时，调用构造函数。当对已经存在对象进行赋值时，调用赋值函数</p>
</li>
<li><p>拷贝<code>(copy)</code>对应深拷贝，需要再申请一份动态内存，然后复制数据。移动<code>(move)</code>对应浅拷贝，最后需要对将亡<code>(about to died)</code>对象的指针进行置空</p>
</li>
<li><p>赋值函数中需要注意自赋值，以及当被赋值对象的指针已经有内容时要进行释放。对于拷贝赋值函数<code>copy assignment function</code>，需要先申请动态内存，然后再修改被赋值的对象，因为动态申请可能会有异常抛出，这种做法是比较安全的</p>
</li>
<li><p>对于移动<code>(move)</code>函数，可以通过<code>std::move()</code>显式调用。对于函数返回值等临时变量，默认调用<code>move</code>函数，以减少数据的移动</p>
</li>
</ol>
<blockquote>
<p>作者水平有限，也是参考了很多别人的写法，很有可能出现错误，欢迎大家留言提意见</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/05/c-c-%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiaobendaye">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/05/c-c-%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B/" class="post-title-link" itemprop="url">c/c++ 编译流程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-05 09:50:24 / 修改时间：16:12:41" itemprop="dateCreated datePublished" datetime="2020-09-05T09:50:24+08:00">2020-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>常用的编译器有GNU的gcc/g++与LLVM的clang/clang++，大多数情况下，我们都是直接生成<code>.o</code>、<code>.a</code>、<code>.so</code>或可执行文件。但是，其实编译器在背后默默地做了很多工作，这篇文章就来简单介绍一下编译器的”深藏功与名”。</p>
<h2 id="编译的大致流程"><a href="#编译的大致流程" class="headerlink" title="编译的大致流程"></a>编译的大致流程</h2><table>
<thead>
<tr>
<th align="left">流程</th>
<th align="center">输入文件</th>
<th align="center">输出文件</th>
<th align="center">工具链</th>
</tr>
</thead>
<tbody><tr>
<td align="left">预处理（<code>preprocessing</code>）</td>
<td align="center"><code>*.cpp,*.h</code></td>
<td align="center"><code>*.i</code></td>
<td align="center"><code>cpp test.cpp &gt; test.i</code></td>
</tr>
<tr>
<td align="left">汇编1(<code>compilation</code>)</td>
<td align="center"><code>*.i</code></td>
<td align="center"><code>*.s</code></td>
<td align="center"><code>g++ -g -S test.i</code></td>
</tr>
<tr>
<td align="left">汇编2( <code>assembly</code>)</td>
<td align="center"><code>*.s</code></td>
<td align="center"><code>*.o</code></td>
<td align="center"><code>as -o test.o test.s</code></td>
</tr>
<tr>
<td align="left">链接（<code>linking</code>)</td>
<td align="center"><code>*.o,*.so\*.dll,*.a</code></td>
<td align="center"><code>executable</code></td>
<td align="center"><code>ld -o myTest test.o ...</code></td>
</tr>
</tbody></table>
<hr>
<p>下面，我们使用一个简单的<code>hello world</code>程序来演示</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//filename: test.cpp</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;hello world\n&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="一，预处理"><a href="#一，预处理" class="headerlink" title="一，预处理"></a>一，预处理</h3><p>在源文件和头文件中<code>#define, #if</code>等以及<code>#include</code>都可以看作预处理命令，编译器会使用类似字符串替换的方式将其展开，使用的是<code>cpp</code>工具。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cpp test.cpp &gt; test.i</span><br></pre></td></tr></table></figure>
<p>执行后，得到了一个预处理后的文件<code>test.i</code>，该文件长达<code>28000</code>多行，主要是我们导入的头文件<code>iostream.h</code>展开后的内容。</p>
<h3 id="二，汇编"><a href="#二，汇编" class="headerlink" title="二，汇编"></a>二，汇编</h3><p>该部分分为两步：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ -g -S test.i</span><br><span class="line">as -o test.o test.s</span><br></pre></td></tr></table></figure>
<p>首先将<code>.i</code>文件汇编（<code>compilation</code>）成汇编代码<code>.s</code>文件，编译器优化就发生在这里。然后将汇编文件翻译（<code>assembly</code>）成机器所能识别的二进制<code>.o</code>文件。</p>
<p>至此，我们得到了目标文件，大多数情况下，我们都是通过编译器的<code>-c</code>参数直接得到它。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -o test.o -c test.cpp</span><br></pre></td></tr></table></figure>
<h3 id="三，链接"><a href="#三，链接" class="headerlink" title="三，链接"></a>三，链接</h3><p>在这一步，操作的都是二进制文件。<br>在我们得到<code>.o</code>文件之后，需要使用<code>ld</code>命令将其与其他目标文件<code>.o</code>，静态链接库<code>.a</code>或动态链接库<code>.so\.dll</code>相链接后，生成一个由<code>main</code>为入口的可执行文件<code>myTest</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ld -o myTest test.o /usr/lib/x86_64-linux-gnu/Scrt1.o /usr/lib/x86_64-linux-gnu/crti.o /usr/lib/gcc/x86_64-linux-gnu/7/crtbeginS.o /usr/lib/gcc/x86_64-linux-gnu/7/crtendS.o /usr/lib/x86_64-linux-gnu/crtn.o -L /usr/lib/gcc/x86_64-linux-gnu/7 -lstdc++ -lc -dynamic-linker /lib64/ld-linux-x86-64.so.2</span><br></pre></td></tr></table></figure>

<p>参考文献<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6264249/how-does-the-compilation-linking-process-work">How does the compilation/linking process work?</a></p>
<hr>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>###一，静态与动态链接库<br>在链接阶段，编译器把二进制文件中的变量和函数都看作<code>symbol</code>，然后就像搭积木一样，按照<code>symbol</code>把<code>.o</code>、<code>.a</code>和<code>.so</code>拼接起来。如果在这些文件中，定义和实现未能对应，则链接失败。</p>
<p>不同的是，静态链接库是直接包含在可执行文件中，而动态链接库是在运行时才会调用。因此，静态链接会使可执行文件明显变大，而动态链接则不会。另外，当系统环境发生改变时，需要保证动态链接库始终能被访问到。</p>
<p>###二，汇编注释（反汇编）<br><code>.o</code>文件可以用来反汇编，将机器可读的二进制文件转为人类可读的汇编文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objdump -d -M intel -S test.o &gt; test.ss</span><br></pre></td></tr></table></figure>
<p><code>test.ss</code>文件包含了汇编代码以及对应的<code>c/c++</code>语句注释。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/05/ubuntu%E4%B8%8B%E9%80%9A%E8%BF%87virtualbox%E5%AE%89%E8%A3%85%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%89%93%E5%BC%80%E6%91%84%E5%83%8F%E5%A4%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiaobendaye">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/05/ubuntu%E4%B8%8B%E9%80%9A%E8%BF%87virtualbox%E5%AE%89%E8%A3%85%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%89%93%E5%BC%80%E6%91%84%E5%83%8F%E5%A4%B4/" class="post-title-link" itemprop="url">ubuntu下通过virtualbox安装虚拟机并打开摄像头</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-05 09:49:17 / 修改时间：16:12:41" itemprop="dateCreated datePublished" datetime="2020-09-05T09:49:17+08:00">2020-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>本人的host系统为ubuntu18.04,如果你的是windows，可能不适用本教程</p>
</blockquote>
<h2 id="1-安装virtualbox以及增强包"><a href="#1-安装virtualbox以及增强包" class="headerlink" title="1. 安装virtualbox以及增强包"></a>1. 安装virtualbox以及增强包</h2><ul>
<li>建议去<a target="_blank" rel="noopener" href="https://www.virtualbox.org/wiki/Downloads">官网</a>下载最新的版本,<br>注意：如果要实现屏幕自适应窗口和粘贴板共享需要下载VM增强包和guest　addition(后者要等到后面下载)</li>
<li>增强包要下载版本对应的才行，双击即可安装</li>
<li>安装完virtualbox和增强包后，需要把当前用户加到　<code>vboxusers</code>组里面，否则的话摄像头无法识别为usb设备，会出错<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -a -G vboxusers $(whoami)</span><br></pre></td></tr></table></figure>
添加后，需要<code>reboot</code>或者<code>log out</code></li>
</ul>
<hr>
<h2 id="２-下载镜像并配置虚拟机"><a href="#２-下载镜像并配置虚拟机" class="headerlink" title="２. 下载镜像并配置虚拟机"></a>２. 下载镜像并配置虚拟机</h2><ul>
<li><p>下载镜像没有什么好讲的</p>
</li>
<li><p>安装虚拟机时，需要注意usb的版本，老式的摄像头是usb2.0，而现在的有很大可能是usb3.0．版本必须选对</p>
</li>
<li><p>当虚拟机安装好之后，就要安装guest additon了，这样才能打通host与guest之间的联系．<br>＊　在<code>devices</code> 下选择　<code>insert guest additon cd image</code><br>＊　如果本地没有，会弹出确认下载的窗口，放心下载就行了<br>＊　下载好后，再次<code>insert guest additon cd image</code>，guest里会弹出请求执行安装的窗口，安装好之后，guest的屏幕就可调节了</p>
</li>
</ul>
<hr>
<h2 id="３-Guest-打开摄像头"><a href="#３-Guest-打开摄像头" class="headerlink" title="３. Guest 打开摄像头"></a>３. Guest 打开摄像头</h2><ul>
<li><p>如果前面的步骤都没错的话，会在<code>devices --&gt; usb </code>下面看到摄像头的信息，在前面打勾就能把摄像头的使用权送给guest了</p>
</li>
<li><p>假如摄像头在<code>devices --&gt; webcams</code>,说明没有把当前用户加到<code>vboxusers</code>里面，是无法使用的</p>
</li>
<li><p>ubuntu 通过cheese可以打开摄像头</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/05/linux%E4%B8%8B%E6%90%AD%E5%BB%BAv2ray%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="jiaobendaye">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/05/linux%E4%B8%8B%E6%90%AD%E5%BB%BAv2ray%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%92%8C%E5%AE%A2%E6%88%B7%E7%AB%AF/" class="post-title-link" itemprop="url">linux下搭建v2ray服务端和客户端</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-05 09:47:53 / 修改时间：16:12:41" itemprop="dateCreated datePublished" datetime="2020-09-05T09:47:53+08:00">2020-09-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>由于ssr的越来越不稳定，所以拥抱v2ray成为一个不错的选择。</p>
<h2 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h2><blockquote>
<p>这里假设你已经购买<a target="_blank" rel="noopener" href="https://www.vultr.com/?ref=7222423"><code>[点此链接]</code></a>了vps(<code>centos7</code>)以及能ssh登录，服务端的操作均在此vps上。</p>
</blockquote>
<ol>
<li>通过一键安装脚本安装<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%一路默认就行</span><br><span class="line">yum update -y &amp;&amp; yum install -y curl &amp;&amp; bash &lt;(curl -L -s https:&#x2F;&#x2F;install.direct&#x2F;go.sh)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>备注：v2ray 是通过systemctl来管理的，通过<code>systemctl start v2ray</code>来启动服务端的服务。</li>
</ul>
<ol start="2">
<li>安装bbr</li>
</ol>
<p>在centos上的v2ray默认是没有bbr加速的，如果不安装的话会非常慢。v2ray已经提供了安装脚本，只需执行 <code>v2ray bbr</code>,按照提示安装就行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@vultr ~]# v2ray bbr</span><br><span class="line"></span><br><span class="line"> 1. 安装 BBR</span><br><span class="line"></span><br><span class="line"> 2. 安装 LotServer(锐速)</span><br><span class="line"></span><br><span class="line"> 3. 卸载 LotServer(锐速)</span><br><span class="line"></span><br><span class="line">请选择 [1-3]:1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3.开放端口，这里假设用的63064，然后重启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone&#x3D;public --add-port&#x3D;63064&#x2F;tcp --permanent</span><br></pre></td></tr></table></figure>
<p>4.查看v2ray配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@vultr ~]# v2ray </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">........... V2Ray 管理脚本 v3.13 by 233v2.com ..........</span><br><span class="line"></span><br><span class="line">## V2Ray 版本: v4.20.0  &#x2F;  V2Ray 状态: 正在运行 ##</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  1. 查看 V2Ray 配置</span><br><span class="line"></span><br><span class="line">  2. 修改 V2Ray 配置</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">温馨提示...如果你不想执行选项...按 Ctrl + C 即可退出</span><br><span class="line"></span><br><span class="line">请选择菜单 [1-11]:1</span><br><span class="line">---------- V2Ray 配置信息 -------------</span><br><span class="line"></span><br><span class="line"> 地址 (Address) &#x3D; 149.28.**.**</span><br><span class="line"></span><br><span class="line"> 端口 (Port) &#x3D; 63064</span><br><span class="line"></span><br><span class="line"> 用户ID (User ID &#x2F; UUID) &#x3D; *****-42a6-4e42-9f5b-1779eae25a3d</span><br><span class="line"></span><br><span class="line"> 额外ID (Alter Id) &#x3D; 233</span><br><span class="line"></span><br><span class="line"> 传输协议 (Network) &#x3D; tcp</span><br><span class="line"></span><br><span class="line"> 伪装类型 (header type) &#x3D; none</span><br><span class="line"></span><br><span class="line">---------- END -------------</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当端口开放之后，记着配置，然后在本机上配置客户端</p>
<h2 id="客户端-linux"><a href="#客户端-linux" class="headerlink" title="客户端-linux"></a>客户端-linux</h2><blockquote>
<p>同样的，这里介绍linux下的客户端配置过程</p>
</blockquote>
<ol>
<li>安装客户端<ul>
<li>如果你之前使用的ssr，要将其关闭，不然1080端口会冲突。</li>
<li>获取一键安装脚本<br><code>curl -L -s https://install.direct/go.sh</code></li>
<li>由于该脚本默认执行时，需要访问国外的服务器下载<code>v2ray-linux-64.zip</code>文件，如果不走代理肯定会下载失败。这里我通过坚果云分享给大家<a target="_blank" rel="noopener" href="https://www.jianguoyun.com/p/De0ZE0UQsOSjBxjLm_QB">坚果云</a></li>
<li>下载完成后，把<code>go.sh</code>与<code>v2ray-linux-64.zip</code>放在同一个文件夹，在终端下执行<br><code>sudo bash go.sh --local ./v2ray-linux-64.zip </code></li>
</ul>
</li>
<li>配置客户端<ul>
<li><code>sudo gedit /etc/v2ray/config.json</code>，将以下内容粘贴进去，注意要按照服务端的配置信息修改对应的位置。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;inbounds&quot;: [&#123;</span><br><span class="line">    &quot;port&quot;: 1080,  &#x2F;&#x2F; SOCKS 代理端口，在浏览器中需配置代理并指向这个端口</span><br><span class="line">    &quot;listen&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">    &quot;protocol&quot;: &quot;socks&quot;,</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">      &quot;udp&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;],</span><br><span class="line">  &quot;outbounds&quot;: [&#123;</span><br><span class="line">    &quot;protocol&quot;: &quot;vmess&quot;,</span><br><span class="line">    &quot;settings&quot;: &#123;</span><br><span class="line">      &quot;vnext&quot;: [&#123;</span><br><span class="line">        &quot;address&quot;: &quot;149.28.**.**&quot;, &#x2F;&#x2F; 服务器地址，请修改为你自己的服务器 ip 或域名</span><br><span class="line">        &quot;port&quot;: 63064,  &#x2F;&#x2F; 服务器端口</span><br><span class="line">        &quot;users&quot;: [&#123; &quot;id&quot;: &quot;*****-42a6-4e42-9f5b-1779eae25a3d&quot; &#125;]&#x2F;&#x2F;要与服务端保持一致</span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    &quot;protocol&quot;: &quot;freedom&quot;,</span><br><span class="line">    &quot;tag&quot;: &quot;direct&quot;,</span><br><span class="line">    &quot;settings&quot;: &#123;&#125;</span><br><span class="line">  &#125;],</span><br><span class="line">  &quot;routing&quot;: &#123;</span><br><span class="line">    &quot;domainStrategy&quot;: &quot;IPOnDemand&quot;,</span><br><span class="line">    &quot;rules&quot;: [&#123;</span><br><span class="line">      &quot;type&quot;: &quot;field&quot;,</span><br><span class="line">      &quot;ip&quot;: [&quot;geoip:private&quot;],</span><br><span class="line">      &quot;outboundTag&quot;: &quot;direct&quot;</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>这样，客户端就配置好了。使用<code>sudo service v2ray restart</code>,重启服务。</li>
</ul>
</li>
</ul>
</li>
</ol>
<ol start="3">
<li>安装SwitchyOmga<br>这是一个浏览器插件，用于修改浏览器访问internet时的代理。具体怎么配置的不是这里的重点，就不讲了。</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">jiaobendaye</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">16</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jiaobendaye</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
